{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
NOTE TO DEVELOPERS: welcome to Impact theme! We hope that you will enjoy editing this theme as much as we did for
  developing it. We have put a lot of work to make this theme as developer friendly as possible by offering you
  hooks to integrate into critical parts of the theme. You will find the complete technical documentation (including
  all events, dependencies...) in the "documentation.txt" file, located in the Assets folder.
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<!doctype html>

<html lang="{{ request.locale.iso_code }}" dir="{% render 'direction' %}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="theme-color" content="{{ settings.header_background }}">

    <title>{% if page_title == blank %}{{ shop.name }}{% else %}{{ page_title }}{% if current_page != 1 %} &ndash; {{ 'general.page' | t: page: current_page }}{% endif %}{% endif %}</title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | image_url: width: 96 }}">
      <link rel="apple-touch-icon" href="{{ settings.favicon | image_url: width: 180 }}">
    {%- endif -%}

    {%- comment -%}Few prefetch to increase performance on commonly used third-parties{%- endcomment -%}
    <link rel="preconnect" href="https://cdn.shopify.com">
    <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    <link rel="dns-prefetch" href="https://productreviews.shopifycdn.com">

    {%- unless settings.heading_font.system? -%}
      <link rel="preload" href="{{ settings.heading_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}

    {%- unless settings.text_font.system? -%}
      <link rel="preload" href="{{ settings.text_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}

    {%- render 'social-meta-tags' -%}
    {%- render 'microdata-schema' -%}
    {%- render 'css-variables' -%}
    {%- render 'js-variables' -%}

    <script>
      if (!(HTMLScriptElement.supports && HTMLScriptElement.supports('importmap'))) {
        const importMapPolyfill = document.createElement('script');
        importMapPolyfill.async = true;
        importMapPolyfill.src = "{{ 'es-module-shims.min.js' | asset_url }}";

        document.head.appendChild(importMapPolyfill);
      }
    </script>

    <script type="importmap">
      {%- comment -%}On Safari 16.3 and lower, a polyfill is used to load importmap{%- endcomment -%}
      {
        "imports": {
          "vendor": "{{ 'vendor.min.js' | asset_url }}",
          "theme": "{{ 'theme.js' | asset_url }}",
          "photoswipe": "{{ 'photoswipe.min.js' | asset_url }}"
        }
      }
    </script>

    <script type="module" src="{{ 'vendor.min.js' | asset_url }}"></script>
    <script type="module" src="{{ 'theme.js' | asset_url }}"></script>

    {{ content_for_header }}

 {{ 'theme.css' | asset_url | stylesheet_tag: preload: true }}
 
  <meta name="facebook-domain-verification" content="r6215rl74qi6yxok27svncs4942yzw" />  

<!-- TikTok Pixel Code Start -->
<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};


  ttq.load('D5G2UJRC77U3DS9AQU4G');
  ttq.page();
}(window, document, 'ttq');
</script>
<!-- TikTok Pixel Code End -->
</head>


  <body class="{% if settings.zoom_image_on_hover %}zoom-image--enabled{% endif %}">
    {%- render 'shadow-dom-templates' -%}

    <a href="#main" class="skip-to-content sr-only">{{ 'general.accessibility.skip_to_content' | t }}</a>

    {%- if request.page_type != 'password' -%}
      {%- sections 'header-group' -%}
      {%- sections 'overlay-group' -%}

      {%- if settings.cart_type == 'popover' -%}
        <cart-notification-drawer open-from="bottom" class="quick-buy-drawer drawer"></cart-notification-drawer>
      {%- endif -%}
    {%- endif -%}

    {%- if request.page_type == 'customers/account' or request.page_type == 'customers/order' or request.page_type == 'customers/addresses' -%}
      {%- section 'account-banner' -%}
    {%- endif -%}

    <main role="main" id="main" class="anchor">
      {{ content_for_layout }}

      {%- comment -%}
      IMPLEMENTATION NOTE: due to the very complex logic of margin/padding collapsing in Impact, the footer group is
      added into the main element to ensure that dynamic sections added into the footer group are properly laid out.
      {%- endcomment -%}
      {%- if request.page_type != 'password' -%}
        {%- sections 'footer-group' -%}
      {%- endif -%}
    </main>









<!-- WIDGET CHAT ELINEA (Ã  coller dans Shopify -> theme.liquid avant </body>) -->
<div id="elinea-chat" style="position:fixed;bottom:20px;right:20px;z-index:99999;font-family:Arial;">
  <button id="elinea-chat-btn" style="padding:12px 14px;border-radius:999px;border:0;cursor:pointer;">
    ðŸ’¬ Besoin dâ€™aide ?
  </button>

  <div id="elinea-chat-box" style="display:none;width:320px;height:420px;background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.15);overflow:hidden;margin-top:10px;">
    <div style="padding:12px 14px;font-weight:700;border-bottom:1px solid #eee;">
      Assistant ELINEA
    </div>
    <div id="elinea-chat-messages" style="padding:12px 14px;height:310px;overflow:auto;font-size:14px;"></div>
    <div style="display:flex;gap:8px;padding:10px;border-top:1px solid #eee;">
      <input id="elinea-chat-input" placeholder="Ã‰cris ta questionâ€¦" style="flex:1;padding:10px;border:1px solid #ddd;border-radius:10px;">
      <button id="elinea-chat-send" style="padding:10px 12px;border-radius:10px;border:0;cursor:pointer;">Envoyer</button>
    </div>
  </div>
</div>

<script>
  const API_BASE = "TON_URL_RENDER"; // ex: "https://elinea-chat.onrender.com"

  let sessionId = localStorage.getItem("elinea_session_id");
  if (!sessionId) {
    sessionId = Math.random().toString(16).slice(2) + Date.now().toString(16);
    localStorage.setItem("elinea_session_id", sessionId);
  }

  const btn = document.getElementById("elinea-chat-btn");
  const box = document.getElementById("elinea-chat-box");
  const messages = document.getElementById("elinea-chat-messages");
  const input = document.getElementById("elinea-chat-input");
  const send = document.getElementById("elinea-chat-send");

  btn.onclick = () => {
    box.style.display = box.style.display === "none" ? "block" : "none";
    if (!messages.dataset.welcome) {
      addMsg("assistant", "Salut ðŸ‘‹ Je peux tâ€™aider Ã  choisir ou rÃ©pondre sur livraison/retours. Tu veux une recommandation ?");
      messages.dataset.welcome = "1";
    }
  };

  function escapeHtml(str){
    return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }

  function addMsg(role, text) {
    const div = document.createElement("div");
    div.style.margin = "8px 0";
    div.style.whiteSpace = "pre-wrap";
    div.innerHTML = `<b>${role === "user" ? "Toi" : "ELINEA"}</b><br>${escapeHtml(text)}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  async function sendMsg() {
    const text = input.value.trim();
    if (!text) return;
    input.value = "";
    addMsg("user", text);

    const res = await fetch(API_BASE + "/chat", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-session-id": sessionId
      },
      body: JSON.stringify({ message: text, pageUrl: window.location.href })
    });

    const data = await res.json();
    addMsg("assistant", data.answer || "DÃ©solÃ©, jâ€™ai eu un souci. RÃ©essaie.");
  }

  send.onclick = sendMsg;
  input.addEventListener("keydown", (e) => { if (e.key === "Enter") sendMsg(); });
</script>
<!-- FIN WIDGET -->



  </body>
</html>